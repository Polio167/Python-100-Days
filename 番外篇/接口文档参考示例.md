## 介面文件參考示例

0. 使用者登入 - **POST** `/api/login/`

      開發者：駱昊

      版本號：v1

      最後修改時間：

      介面說明：登入成功後，會生成或更新使用者令牌（token）。

      使用幫助：測試資料庫中預設了四個可供使用的賬號，如下表所示。

      | 使用者名稱     | 使用者口令 | 角色         |
      | ---------- | -------- | ------------ |
      | jackfrued  | 123456   | 管理員       |
      | wangdachui | 123123   | 普通使用者     |
      | hellokitty | 123123   | 房地產經理人 |
      | wuzetian   | 123456   | 房東         |

      請求引數：

      | 引數名   | 型別   | 是否必填 | 引數位置 | 說明     |
      | -------- | ------ | -------- | -------- | -------- |
      | username | 字串 | 是       | 訊息體   | 使用者名稱   |
      | password | 字串 | 是       | 訊息體   | 使用者口令 |

      響應資訊：

      - 登入成功：

        ```JSON
        {
            "code": 30000,
            "message": "使用者登入成功",
            "token": "f83e0f624e2311e9af1f00163e02b646"
        }
        ```

      - 登入失敗：

        ```JSON
        {
            "code": 30001,
            "message": "使用者名稱或密碼錯誤"
        }
        ```

1. 傳送簡訊驗證碼 - **GET** `/api/mobile_code/{國內手機號}/`

   開發者：駱昊

   版本號：v1

   介面說明：給指定手機號傳送簡訊驗證碼的介面，手機號必須是國內手機號，作為路徑引數寫到URL中。介面顯示簡訊傳送成功時，指定的手機號並不會收到短息，因為使用的三方簡訊平臺贈送的測試簡訊已經用完了。

   使用幫助：國內手機號暫不支援國際區號。

   請求引數：暫無。

   響應資訊：

   - 請求成功：

     ```JSON
     {
         "code": 10001,
         "msg": "簡訊驗證碼傳送成功"
     }
     ```

   - 兩次請求間隔小於60秒：

     ```JSON
     {
         "code": 10002,
         "msg": "請不要在60秒以內重複傳送手機驗證碼"
     }
     ```

   - 手機號無效：

     ```JSON
     {
         "code": 10003,
         "msg": "請提供有效的手機號"
     }
     ```

   - 簡訊服務平臺故障：

     ```JSON
     {
         "code": 10004,
         "msg": "簡訊服務暫時無法使用"
     }
     ```

2. 獲取所有省級行政單位 - **GET** `/api/districts/`

   開發者：駱昊

   版本號：v1

   介面說明：暫無。

   使用幫助：暫無。

   請求引數：暫無。

   響應資訊：

   ```JSON
   [
       {
           "distid": 110000,
           "name": "北京市"
       },
       {
           "distid": 120000,
           "name": "天津市"
       }
   ]
   ```

3. 獲取指定行政單位詳情及其管轄的行政單位 - **GET** `/api/districts/{行政單位編號}/`

   開發者：駱昊

   版本號：v1

   介面說明：透過URL引數指定行政單位編號，如果行政單位編號為省級行政單位編號，則返回該省以及該省所轄市級行政單位的資訊；如果行政單位編號為市級行政單位編號，則返回該市以及該市所轄區縣的資訊；如果行政單位編號為區縣一級行政單位編號，則返回該區縣的資訊，下級行政單位`cities`屬性值為`[]`。

   使用幫助：資料庫中除四川省外其他行政單位的“intro”資料都沒有錄入，該欄位可能為空字串。

   請求引數：暫無。

   響應資訊：

   ```JSON
   {
       "distid": 510000,
       "name": "四川省",
       "intro": "位於中國西南地區內陸，東連重慶，南鄰雲南、貴州，西接西藏，北界陝西、甘肅、青海，四川省總面積48.6萬平方千米，省會成都。截至2018年底，四川省下轄18個省轄市，3個自治州，17個縣級市，108個縣，4個自治縣，54個市轄區。",
       "cities": [
           {
               "distid": 510100,
               "name": "成都市"
           },
           {
               "distid": 510300,
               "name": "自貢市"
           },
           {
               "distid": 510400,
               "name": "攀枝花市"
           }
       ]
   }
   ```

4. 獲取熱門城市 - **GET** `/api/hotcities/`

   開發者：駱昊

   版本號：v1

   介面說明：暫無。

   使用幫助：暫無。

   請求引數：暫無。

   響應資訊：

   ```JSON
   [
       {
           "distid": 110100,
           "name": "北京市"
       },
       {
           "distid": 120100,
           "name": "天津市"
       },
       {
           "distid": 130100,
           "name": "石家莊"
       }
   ]
   ```

5. 分頁獲取房地產經理人資訊 - **GET** `/api/agents/`

   開發者：駱昊

   版本號：v1

   介面說明：經理人姓名按照字首模糊匹配的方式進行處理；經理人服務星級是指經理人服務星級不得低於該星級；經理人是否持證只有0（未持證上崗）和1（持證上崗）兩個選項。三個引數代表的篩選條件之間是而且的關係。返回結果為分頁之後的房地產經理人資訊。

   使用幫助：暫無。

   請求引數：

   | 引數名 | 型別   | 是否必填 | 引數位置 | 說明                                |
   | ------ | ------ | -------- | -------- | ---------------------------------|
   | name   | 字串 | 否       | 查詢引數 | 經理人姓名                          |
   | key    | 字串 | 否       | 查詢引數 | 經理人服務星級                      |
   | cert   | 字串 | 否       | 查詢引數 | 經理人是否持證                      |
   | page   | 整數   | 否       | 查詢引數 | 頁碼，預設值為1                     |
   | size   | 整數   | 否       | 查詢引數 | 頁面大小，預設值為5，最大值不超過50 |

   響應資訊：

   ```JSON
   {
       "count": 1,
       "next": null,
       "previous": null,
       "results": [
           {
               "agentid": 6,
               "estates": [
                   {
                       "estateid": 11,
                       "name": "靈芝新村",
                       "hot": 20
                   }
               ],
               "name": "肖利麗",
               "tel": "13040813886",
               "servstar": 4,
               "realstar": 4,
               "profstar": 4,
               "certificated": false
           }
       ]
   }
   ```

6. 新增房地產經理人 - **POST** `/api/agents/`

   開發者：駱昊

   版本號：v1

   介面說明：暫無。

   使用幫助：需要登入且擁有管理員許可權，使用者身份令牌在請求頭中提供。

   請求引數：

   | 引數名       | 型別   | 是否必填 | 引數位置 | 說明             |
   | ------------ | ------ | -------- | -------- | ---------------- |
   | name         | 字串 | 是       | 訊息體   | 經理人姓名       |
   | tel          | 字串 | 是       | 訊息體   | 經理人手機       |
   | servstar     | 整數   | 否       | 訊息體   | 預設值0          |
   | realstar     | 整數   | 否       | 訊息體   | 預設值0          |
   | profstar     | 整數   | 否       | 訊息體   | 預設值0          |
   | certificated | 整數   | 否       | 訊息體   | 預設值0          |
   | token        | 字串 | 是       | 請求頭   | 使用者身份認證令牌 |

   響應資訊：

   - 新增成功 - 狀態碼**201**：

     ```JSON
     {
         "agentid": 8,
         "estates": [],
         "name": "孫小美",
         "tel": "13800991234",
         "servstar": 0,
         "realstar": 0,
         "profstar": 0,
         "certificated": false
     }
     ```

   - 未提供身份認證資訊 - 狀態碼**401**：

     ```JSON
     {
         "detail": "不正確的身份認證資訊。"
     }
     ```

   - 當前使用者沒有操作許可權 - 狀態碼**403**：

     ```JSON
     {
         "detail": "您沒有執行該操作的許可權。"
     }
     ```

7. 編輯房地產經理人資訊 - **PUT** `/api/agents/{房地產經理人編號}/`

    開發者：駱昊

    版本號：v1

    介面說明：暫無。

    使用幫助：需要登入且擁有管理員許可權，使用者身份令牌在請求頭中提供。

    請求引數：

    | 引數名       | 型別   | 是否必填 | 引數位置 | 說明             |
    | ------------ | ------ | -------- | -------- | ---------------- |
    | name         | 字串 | 是       | 訊息體   | 經理人姓名       |
    | tel          | 字串 | 是       | 訊息體   | 經理人手機       |
    | servstar     | 整數   | 否       | 訊息體   | 預設值0          |
    | realstar     | 整數   | 否       | 訊息體   | 預設值0          |
    | profstar     | 整數   | 否       | 訊息體   | 預設值0          |
    | certificated | 整數   | 否       | 訊息體   | 預設值0          |
    | token        | 字串 | 是       | 請求頭   | 使用者身份認證令牌 |

    響應資訊：

    - 更新成功 - 狀態碼**200**：
      
     ```JSON
     {
         "agentid": 1,
         "estates": [
             {
                 "estateid": 1,
                 "name": "今日家園",
                 "hot": 20
             },
             {
                 "estateid": 2,
                 "name": "翡翠園",
                 "hot": 30
             },
             {
                 "estateid": 3,
                 "name": "萬科城市花園",
                 "hot": 22
             }
         ],
         "name": "袁曉夢",
         "tel": "158173555285",
         "servstar": 5,
         "realstar": 4,
         "profstar": 3,
         "certificated": true
     }
     ```

    - 未提供身份認證資訊 - 狀態碼**403** - 與新增類同
    - 當前使用者沒有操作許可權 - 狀態碼**403** - 與新增類同

8. 刪除房地產經理人 - **DELETE** `/api/agents/{房地產經理人編號}/`

    開發者：駱昊

    版本號：v1

    介面說明：暫無。

    使用說明：暫無。

    請求引數：

    | 引數名 | 型別   | 是否必填 | 引數位置 | 說明             |
    | ------ | ------ | -------- | -------- | ---------------- |
    | token  | 字串 | 是       | 請求頭   | 使用者身份認證令牌 |

    響應資訊：

    - 刪除成功 - 狀態碼**204**
    - 未提供身份認證資訊 - 狀態碼**403** - 與新增類同
    - 當前使用者沒有操作許可權 - 狀態碼**403** - 與新增類同

9. 分頁獲取樓盤資訊 - **GET** `/api/estates/`

    開發者：駱昊

    版本號：v1

    介面說明：經理人姓名按照字首模糊匹配的方式進行處理；經理人服務星級是指經理人服務星級不得低於該星級；經理人是否持證只有0（未持證上崗）和1（持證上崗）兩個選項。三個引數代表的篩選條件之間是而且的關係。返回結果為分頁之後的房地產經理人資訊。

    使用幫助：暫無。

    請求引數：

    | 引數名 | 型別   | 是否必填 | 引數位置 | 說明                                |
    | ------ | ------ | -------- | -------- | ----------------------------------- |
    | name   | 字串 | 否       | 查詢引數 | 樓盤名（模糊匹配）                  |
    | dist   | 字串 | 否       | 查詢引數 | 樓盤所在地區編號                    |
    | page   | 整數   | 否       | 查詢引數 | 頁碼，預設值為1                     |
    | size   | 整數   | 否       | 查詢引數 | 頁面大小，預設值為5，最大值不超過50 |

    響應資訊：

    ```JSON
    {
        "count": 16,
        "next": "https://120.77.222.217/api/estates/?page=2",
        "previous": null,
        "results": [
            {
                "estateid": 6,
                "district": {
                    "distid": 440303,
                    "name": "羅湖區"
                },
                "agents": [
                    {
                        "agentid": 2,
                        "name": "楊偉",
                        "tel": "13352939550",
                        "servstar": 3
                    },
                    {
                        "agentid": 4,
                        "name": "郭志鵬",
                        "tel": "13686810707",
                        "servstar": 4
                    }
                ],
                "name": "幸福裡",
                "hot": 300,
                "intro": ""
            }
        ]
    }
    ```

10. 新增樓盤 - **POST** `/api/estates/`

  開發者：駱昊

  版本號：v1

  介面說明：暫無。

  使用幫助：需要登入且擁有管理員許可權，使用者身份令牌在請求頭中提供。

  請求引數：

  | 引數名 | 型別   | 是否必填 | 引數位置 | 說明                     |
  | ------ | ------ | -------- | -------- | ------------------------ |
  | name   | 字串 | 是       | 訊息體   | 樓盤名稱                 |
  | hot    | 整數   | 否       | 訊息體   | 樓盤熱度，預設值0        |
  | intro  | 字串 | 否       | 訊息體   | 樓盤介紹，預設值空字串 |
  | distid | 整數   | 是       | 訊息體   | 樓盤所在地區編號         |
  | token  | 字串 | 是       | 請求頭   | 使用者身份認證令牌         |

  響應資訊：

  - 新增成功 - 狀態碼**201**：
     ```JSON
     {
         "estateid": 17,
         "district": 510107,
         "name": "世紀錦苑",
         "hot": 100,
         "intro": ""
     }
     ```

  - 未提供身份認證資訊 - 狀態碼**403**：
     ```JSON
     {
         "detail": "請提供有效的身份認證資訊"
     }
     ```

  - 當前使用者沒有操作許可權 - 狀態碼**403**：
     ```JSON
     {
         "detail": "You do not have permission to perform this action."
     }
     ```

11. 編輯樓盤資訊 - **PUT** `/api/estates/{樓盤編號}`

12. 刪除樓盤信 - **DELETE** `/api/estates/{樓盤編號}`

13. 獲取所有戶型資訊 - **GET** `/api/housetypes/`

14. 新增戶型 - **POST** `/api/housetypes/`

15. 編輯戶型資訊 - **PUT** `/api/housetypes/{戶型編號}`

16. 刪除戶型 - **DELETE** `/api/housetypes/{戶型編號}`

17. 分頁獲取房源資訊 - **GET** `/api/houseinfos/`

     開發者：駱昊

     版本號：v1

     介面說明：暫無。

     使用幫助：暫無。

     請求引數：    

     | 引數名    | 型別   | 是否必填 | 引數位置 | 說明                                |
     | --------- | ------ | -------- | -------- | ----------------------------------- |
     | title     | 字串 | 否       | 查詢引數 | 房源標題關鍵詞                      |
     | dist      | 整數   | 否       | 查詢引數 | 樓盤所在地區編號                    |
     | min_price | 整數   | 否       | 查詢引數 | 價格區間下限                        |
     | max_price | 整數   | 否       | 查詢引數 | 價格區間上限                        |
     | type      | 整數   | 否       | 查詢引數 | 戶型編號                            |
     | page      | 整數   | 否       | 查詢引數 | 頁碼，預設值為1                     |
     | size      | 整數   | 否       | 查詢引數 | 頁面大小，預設值為5，最大值不超過50 |

     響應資訊：
     ```JSON
     {
         "count": 7,
         "next": "http://localhost:8000/api/houseinfos/?dist=440303&page=2",
         "previous": null,
         "results": [
     
         ]
     }
     ```

18. 檢視房源詳情 - **GET** `/api/houseinfos/{房源編號}`

19. 新增房源 - **POST** `/api/houseinfos/`

20. 編輯房源資訊 - **PUT** `/api/houseinfos/{房源編號}`

21. 刪除房源 - **DELETE** `/api/houseinfos/{房源編號}`

22. 隨機獲取指定數量的房源標籤 - **GET** `/api/tags/`

23. 分頁檢視房源標籤 - **GET** `/api/tags/`

24. 新增房源標籤 - **POST** `/api/tags/`

25. 刪除房源標籤 - **DELETE**  `/api/tags/{房源編號}`

26. 檢視房源的圖片 - **GET** `/api/houseinfos/{房源編號}/photos/`

27. 為房源新增圖片 - **POST** `/api/houseinfos/{房源編號}/photos/`

28. 刪除房源圖片 - **DELETE** `/api/houseinfos/{房源編號}/photos/{圖片編號}`